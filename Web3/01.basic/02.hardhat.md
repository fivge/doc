# Hardhat

Hardhat æ˜¯ä¸€ä¸ªç¼–è¯‘ã€éƒ¨ç½²ã€æµ‹è¯•å’Œè°ƒè¯•ä»¥å¤ªåŠåº”ç”¨çš„å¼€å‘ç¯å¢ƒã€‚

Hardhat å†…ç½®äº† Hardhat ç½‘ç»œï¼Œè¿™æ˜¯ä¸€ä¸ªä¸“ä¸ºå¼€å‘è®¾è®¡çš„æœ¬åœ°ä»¥å¤ªåŠç½‘ç»œã€‚ä¸»è¦åŠŸèƒ½æœ‰ Solidity è°ƒè¯•ï¼Œè·Ÿè¸ªè°ƒç”¨å †æ ˆã€console.log()å’Œäº¤æ˜“å¤±è´¥æ—¶çš„æ˜ç¡®é”™è¯¯ä¿¡æ¯æç¤ºç­‰ã€‚

https://hardhat.org

> code
>
> https://github.com/fivge/hardhad-demo

### 1ã€quick start

#### aã€ç¼–è¯‘åˆçº¦

```bash
yarn hardhat compile
```

å¦‚æœæ‚¨åˆ›å»ºäº† TypeScript é¡¹ç›®ï¼Œæ­¤ä»»åŠ¡è¿˜å°†ä½¿ç”¨ TypeChain ç”Ÿæˆ TypeScript ç»‘å®šã€‚

è¦å¼ºåˆ¶ç¼–è¯‘ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ `--force` å‚æ•°ï¼Œæˆ–è¿è¡Œ `npx hardhat clean` æ¥æ¸…é™¤ç¼“å­˜å¹¶åˆ é™¤å·¥ä»¶ã€‚

#### ~~æµ‹è¯•åˆçº¦~~

#### bã€éƒ¨ç½²åˆçº¦

**[TODO] ğŸ’–https://hardhat.org/ignition/docs/getting-started#overview**

```bash
yarn hardhat run scripts/deploy.ts
```

#### cã€hardhat ç½‘ç»œ

é»˜è®¤æƒ…å†µä¸‹ï¼ŒHardhat å°†åœ¨å¯åŠ¨æ—¶å¯åŠ¨ä¸€ä¸ªæ–°çš„å†…å­˜ä¸­ Hardhat ç½‘ç»œå®ä¾‹ã€‚è¿˜å¯ä»¥ä»¥ç‹¬ç«‹æ–¹å¼è¿è¡Œ Hardhat Networkï¼Œä»¥ä¾¿å¤–éƒ¨å®¢æˆ·ç«¯å¯ä»¥è¿æ¥åˆ°å®ƒã€‚è¿™å¯ä»¥æ˜¯é’±åŒ…ã€Dapp å‰ç«¯æˆ–è„šæœ¬ã€‚

```bash
yarn hardhat node
```

åœ¨æœ¬åœ°ç½‘ç»œä¸Šéƒ¨ç½²

```bash
yarn hardhat run scripts/deploy.ts --network localhost
```

#### dã€éªŒè¯åˆçº¦

https://hardhat.org/hardhat-runner/docs/guides/verifying

https://hardhat.org/hardhat-runner/plugins/nomicfoundation-hardhat-verify

### 2ã€é…ç½®

#### aã€cli

##### `help`

```bash
yarn hardhat help
```

##### `--network`

- `--network localhost`
- `--network hardhat`
- `--network sepolia`

#### bã€`hardhat.config.js`

> config, plugins and custom tasks

https://hardhat.org/hardhat-runner/docs/config#configuration

**Hardhat çš„é…ç½®æ–‡ä»¶å°†å§‹ç»ˆåœ¨ä»»ä½•ä»»åŠ¡ä¹‹å‰è¿è¡Œï¼Œå› æ­¤æ‚¨å¯ä»¥ä½¿ç”¨å®ƒä¸å…¶ä»–å·¥å…·é›†æˆï¼Œä¾‹å¦‚å¯¼å…¥ `@babel/register` ã€‚**

### 3ã€ä»»åŠ¡å’Œè„šæœ¬ tasks & scripts

#### aã€ä»»åŠ¡

https://hardhat.org/hardhat-runner/docs/advanced/create-task

```ts
import { task } from 'hardhat/config';

task('accounts', 'Prints the list of accounts', async (taskArgs, hre) => {
  const accounts = await hre.ethers.getSigners();

  for (const account of accounts) {
    console.log(account.address);
  }
});
```

```bash
yarn hardhat accounts
```

å®ƒçš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä»»åŠ¡çš„åç§°ï¼Œæˆ‘ä»¬åœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨å®ƒæ¥è¿è¡Œå®ƒã€‚ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä»»åŠ¡çš„æè¿°ï¼Œå½“æ‚¨ä½¿ç”¨ `npx hardhat help` æ—¶ä¼šæ‰“å°è¯¥æè¿°ã€‚

ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå¼‚æ­¥å‡½æ•°ï¼Œåœ¨è¿è¡Œä»»åŠ¡æ—¶æ‰§è¡Œã€‚å®ƒæ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼š

å¸¦æœ‰ä»»åŠ¡å‚æ•°çš„å¯¹è±¡ã€‚æˆ‘ä»¬è¿˜æ²¡æœ‰å®šä¹‰ä»»ä½•ã€‚

Hardhat è¿è¡Œæ—¶ç¯å¢ƒæˆ– HREï¼ŒåŒ…å« Hardhat åŠå…¶æ’ä»¶çš„æ‰€æœ‰åŠŸèƒ½ã€‚æ‚¨è¿˜å¯ä»¥æ‰¾åˆ°åœ¨ä»»åŠ¡æ‰§è¡ŒæœŸé—´æ³¨å…¥åˆ° `global` å‘½åç©ºé—´ä¸­çš„æ‰€æœ‰å±æ€§ã€‚

##### å¸¦å‚æ•° `addParam`

```typescript
import { task } from 'hardhat/config';

task('balance', "Prints an account's balance")
  .addParam('account', "The account's address")
  .setAction(async (taskArgs, hre) => {
    const balance = await hre.ethers.provider.getBalance(taskArgs.account);

    console.log(hre.ethers.utils.formatEther(balance), 'ETH');
  });
```

```bash
yarn hardhat balance --help
Usage: hardhat [GLOBAL OPTIONS] balance --account <STRING>

OPTIONS:

  --account     The account's address

balance: Prints an account's balance
```

##### å¯é€‰å‚æ•° `addOptionalParam`

```typescript
task('hello', 'Prints a greeting')
  .addOptionalParam('greeting', 'The greeting to print', 'Hello, World!')
  .setAction(async ({ greeting }) => console.log(greeting));
```

```bash
yarn hardhat hello
# Hello, World!

yarn hardhat hello --greeting foo
# foo
```

##### å­ä»»åŠ¡ `subtask`

```typescript
import { task, subtask } from 'hardhat/config';

task('hello-world', 'Prints a hello world message').setAction(async (taskArgs, hre) => {
  await hre.run('print', { message: 'Hello, World!' });
});

subtask('print', 'Prints a message')
  .addParam('message', 'The message to print')
  .setAction(async taskArgs => {
    console.log(taskArgs.message);
  });
```

#### bã€è„šæœ¬

https://hardhat.org/hardhat-runner/docs/advanced/scripts

`scripts/accounts.ts`

```ts
import { ethers } from 'hardhat';

async function main() {
  const accounts = await ethers.getSigners();

  for (const account of accounts) {
    console.log(account.address);
  }
}

main().catch(error => {
  console.error(error);
  process.exitCode = 1;
});
```

```bash
yarn hardhat run scripts/accounts.ts
```

### 4ã€hre

https://hardhat.org/hardhat-runner/docs/advanced/hardhat-runtime-environment

### 5ã€console

### 6ã€typescript

ä¸ä½¿ç”¨ cliï¼Œç›´æ¥ä½¿ç”¨`ts-node`

```shell
yarn ts-node --files scripts/accounts.ts
```

This can also be enabled with `TS_NODE_FILES=true`

### 7ã€Hardhat Ignition

https://hardhat.org/ignition/docs/guides/creating-modules

Hardhat Ignition æ˜¯ä¸€ä¸ªç”¨äºåœ¨ä»¥å¤ªåŠä¸Šéƒ¨ç½²æ™ºèƒ½åˆçº¦çš„å£°æ˜å¼ç³»ç»Ÿã€‚å®ƒä½¿æ‚¨èƒ½å¤Ÿå®šä¹‰è¦éƒ¨ç½²çš„æ™ºèƒ½åˆçº¦å®ä¾‹ä»¥åŠè¦åœ¨å…¶ä¸Šè¿è¡Œçš„ä»»ä½•æ“ä½œã€‚é€šè¿‡æ¥ç®¡éƒ¨ç½²å’Œæ‰§è¡Œï¼ŒHarhat Ignition å¯è®©æ‚¨ä¸“æ³¨äºé¡¹ç›®ï¼Œè€Œä¸æ˜¯é™·å…¥éƒ¨ç½²ç»†èŠ‚ä¸­ã€‚

#### aã€start

##### å¼•å…¥

```ts
import '@nomicfoundation/hardhat-ignition-ethers';
```

##### æ¨¡å—(module)å®šä¹‰&éƒ¨ç½²

`ignition/modules`

```ts
import { buildModule } from '@nomicfoundation/hardhat-ignition/modules';

export default buildModule('Apollo', m => {
  const apollo = m.contract('Rocket', ['Saturn V']);

  m.call(apollo, 'launch', []);

  return { apollo };
});
```

```bash
yarn hardhat ignition deploy ignition/modules/Apollo.ts --network localhost
```

å°†åˆ›å»ºä¸€ä¸ª `ignition/deployments/chain-31337` æ–‡ä»¶å¤¹ã€‚è¿™åŒ…å«æœ‰å…³æ‚¨çš„éƒ¨ç½²çš„æ‰€æœ‰è¯¦ç»†ä¿¡æ¯ã€‚ Hardhat Ignition ä½¿ç”¨æ­¤æ•°æ®ä»é”™è¯¯ä¸­æ¢å¤ã€æ¢å¤ä¿®æ”¹åçš„éƒ¨ç½²ç­‰ç­‰ã€‚

#### bã€åˆ›å»ºæ¨¡å—

##### éƒ¨ç½²åˆçº¦ m.contract

```js
const token = m.contract('Token', ['My Token', 'TKN', 18]);

const bar = m.contract('ReceivesETH', [], {
  value: 1_000_000_000n, // 1gwei
});
```

##### ä½¿ç”¨ç°æœ‰åˆçº¦ m.contractAt

```ts
const existingToken = m.contractAt('Token', '0x...');
```

##### è°ƒç”¨åˆçº¦ m.call

```ts
m.call(token, "transfer", [receiver, amount]);

m.call(myContract, "receivesEth" [], {
  value: 1_000_000_000n, // 1gwei
});
```

##### ä»åˆçº¦ä¸­è¯»å–å€¼ m.staticCall

å¦‚æœæ‚¨éœ€è¦è°ƒç”¨åˆçº¦ä¸­çš„ `view` æˆ– `pure` å‡½æ•°æ¥æ£€ç´¢å€¼ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ `m.staticCall` æ¥å®Œæˆ

```ts
const balance = m.staticCall(token, 'balanceOf', [address]);
```

##### ä» Future æ‰§è¡ŒæœŸé—´å‘å‡ºçš„äº‹ä»¶ä¸­è¯»å–å€¼ â“

```ts
const transfer = m.call(token, 'transfer', [receiver, amount]);

const value = m.readEventArgument(transfer, 'Transfer', '_value');
```

##### å‘é€ ETH æˆ–æ•°æ®åˆ°è´¦æˆ· â“

```ts
const send = m.send('SendingEth', address, 1_000_000n);
const send = m.send('SendingData', address, undefined, '0x16417104');
```

##### éƒ¨ç½²ä¸€ä¸ªåº“ â“

```ts
const myLib = m.library('MyLib');
```
